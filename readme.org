[[https://melpa.org/#/citar-denote][file:https://melpa.org/packages/citar-denote-badge.svg]]    [[https://stable.melpa.org/#/citar-denote][file:https://stable.melpa.org/packages/citar-denote-badge.svg]]

* Citar-Denote: Literature notes for Denote
Literature is the lifeblood of intellectuals and researchers alike. Note-taking systems are, therefore, often connected to a bibliographic database (such as a BibTeX file). These databases help you to create and find notes related to books, articles and other reference types. Bibliographic databases are also helpful because they provide access to related materials, such as links to online sources and stored electronic versions of relevant books or articles. Lastly, bibliographies are necessary to add citations to your writings.

The /Citar-Denote/ auxiliary package integrates the [[https://github.com/emacs-citar/citar][Citar]] bibliography package with the [[https://protesilaos.com/emacs/denote][Denote]] note-taking system. 

Citar-Denote provides a global minor mode that enables linking notes to a bibliographic entry. Each bibliography item can have one or more notes, and each note can relate to one or more pieces of literature. The citation key for each note is located in the =reference= line in the front matter of your notes, and each bibliographic note is marked with the =_bib= file tag.

In the context of this package, a reference contains one or more pieces of literature associated with a Denote file. A citation is an inline citation reference used for bibliographies. References are for literature reviews, citations are mostly used in other notes types.

The Citar-Denote package works with all Denote file types (Org Mode, Markdown (YAML and TOML) and plain text). The Citar documentation shows to how configure it to add citations t various file types.

** Inner workings
Several Emacs packages are available that can link bibliography files to notes. The [[https://joostkremers.github.io/ebib/][Ebib]], [[https://github.com/tmalsburg/helm-bibtex][Helm-BibTeX and Ivy-BibTeX]] each use their own completion system. The [[https://github.com/emacs-citar/citar][Citar]] package uses minibuffer completion and integrates perfectly with the popular Vertico - Marginalia - Consult - Embark toolchain. The Citar package is an ideal companion to Denote due to its extensibility.

The most common behaviour for these bibliography managers is that the filename for the relevant note includes the citation key (e.g. =einstein_1905.org=) so it can be linked to the BibTeX entry. Other systems, such as Org Roam, use a database or a memory cache. The relationship between citation keys and note files is stored in a cache, generated with the =citar-denote-get-notes= function.

* Functionality
Citar-Denote integrates with Citar and provides five commands specific to Denote:

1. Create a new bibliographic note: =citar-create-note=.
2. Open existing bibliographic notes: =citar-denote-open-note=.
3. Convert existing notes to bibliographic notes: =citar-denote-add-citekey=.
4. Open attachments, URLs or other associated notes: =citar-denote-dwim=.
5. Find a citation in Denote files: =citar-denote-find-citation=.
6. Find Denote file citing the current reference(s): =citar-denote-find-reference=.

** Create bibliographic notes
Open the Citar interface (=citar-create-note=), select the entry you want to create a note for, and hit =ENTER=.

A new note is created in the Denote folder with the title of the BibTeX entry as the default title. You can edit the name of the note and select file tags with the usual Denote menu. If a reference not already exists, a new one is created.

The package uses the default file type set by the =denote-file-type= variable, which you can override with =citar-denote-file-type= to use a different file type for bibliographic notes. 

The =bib= file tag is added by default. This tag is required to minimise the search space for citation references. The =citar-denote-keyword= variable lets you change the tag to something else. If you change the default, you will have to update existing bibliographic notes, as the package only recognises one.

The package adds the citation key to the front matter, e.g. =#+reference: einstein_1905= for an Org Mode file. This line and the file tag link relate the note file to the BibTeX entry. Any changes to this line or the bibliography file tag break that link.

Each reference can have multiple notes, and each note can have multiple references, separated by a semicolon. For example, you could create a note about each book chapter or write a single literature review note for multiple papers. You need to enable this option by setting the =citar-open-always-create-notes= variable to =t=.

If you like to store your bibliographic notes in a specific subdirectory, then set the =citar-denote-subdir= variable to =t=. When this variable is non-nil, Denote will ask for a subdirectory when creating a new bibliographic note.

*** Changing a bibliographic note or converting a Denote buffer to a bibliographic note
The =citar-denote-add-citekey= function adds citation keys or converts an existing Denote file to a bibliographic note.

The function opens the Citar selection menu and adds the selected citation keys to the front matter. Use the =TAB= key to select multiple entries. When converting a regular Denote file, the function adds the =bib= keyword to the front matter and renames the file accordingly.

** Access bibliographic notes
When opening the Citar bibliography menu, The =citar-denote-get-notes= function reads all Denote files tagged with the =bib= keyword and extracts the relevant references. This initialisation can take a few moments if you have a large corpus of bibliographic notes.

Use =citar-denote-open-note= to open the bibliographic menu. Citar indicates the existence of notes with a flag in the second column. Hit enter and select the Denote Notes you like to open.

#+caption: Screenshot with Vertico and symbol customisation.
[[file:citar-menu.png]]

*** Find related information
The =citar-denote-dwim= function provides access to the Citar menu from where you can open attachments, other notes and links related to the citation references associated with the current buffer. Select the attachment, URL or note you like to access and hit =ENTER=.

** Finding citations backlinks
Two functions are available to find notes that cite either references or any other citation in your bibliography.

The =citar-denote-find-citation= opens the Citar menu. If the selected citation is used in a note, then you can open this note.

The =citar-denote-find-reference= function searches for notes that cite any of the references used in the current Denote buffer.

* Installation
This package is available in MELPA. You can install it with  John Wiegley's [[https://github.com/jwiegley/use-package][Use-Package]]:

#+begin_src elisp
  (use-package citar-denote
    :after citar denote
    :config
    (citar-denote-mode)
    (setq citar-open-always-create-notes t))
#+end_src

You can bind the six available commands to your preferred keyboard shortcuts, following the suggestion in the [[https://protesilaos.com/emacs/denote#h:5d16932d-4f7b-493d-8e6a-e5c396b15fd6][Denote manual]], you could use:

#+begin_src elisp
  (let ((map global-map))
    (define-key map (kbd "C-c n c c") #'citar-create-note)
    (define-key map (kbd "C-c n c o") #'citar-denote-open-note)
    (define-key map (kbd "C-c n c d") #'citar-denote-dwim)
    (define-key map (kbd "C-c n c a") #'citar-denote-add-citekey)
    (define-key map (kbd "C-c n c r") #'citar-denote-find-reference)
    (define-key map (kbd "C-c n c f") #'citar-denote-find-citation))
#+end_src

* Acknowledgements
This code would only have existed with the help of Protesilaos Stavrou, developer of Denote and Citar developer Bruce D'Arcus.

In addition, Joel Lööw and Noboru Ota added significant contributions, without which this package would be useless. Guillermo Navarro, Colin McLear and Lucas Gruss provided useful suggestions to extend the functionality.
